# ESP32 통합 시뮬레이터 v1.0 (Python 버전)

인버터 시뮬레이터 + 모의계량기 + RTU 제어 통합 시스템의 PC 환경 실행 버전입니다.

## 🏭 주요 기능

### 인버터 시뮬레이터
- **P제어 모드**: 설정 전력값에 따른 강제 출력
- **MPPT제어 모드**: 환경 조건(일사량, 온도)에 따른 자동 출력
- **발전제한율**: 정격 전력 대비 출력 제한 설정
- **실시간 환경 시뮬레이션**: 일사량, 온도, 위상각 자동 변화

### 모의계량기
- **1차측 데이터**: 인버터에서 직접 수신하는 원본 데이터
- **2차측 변환**: CT/PT 비율 적용 (CT:6, PT:120)
- **계량기 측정값**: 2차측에서 1차측으로 역산된 측정값
- **발전량 누적**: 1차측 실제 발전량 기반 누적 계산

### RTU 제어
- **WP 펄스**: 144Wh(0.144kWh)당 1펄스 생성
- **EOI 신호**: 15분마다 자동 생성
- **오픈컬렉터 출력**: GPIO25(WP), GPIO26(EOI) 시뮬레이션

## 🚀 설치 및 실행

### 1. Python 환경 준비
```bash
# Python 3.7 이상 필요
python --version
```

### 2. 의존성 설치
```bash
pip install -r requirements.txt
```

### 3. 프로그램 실행
```bash
python inverter_simulator.py
```

### 4. 웹 인터페이스 접속
브라우저에서 `http://localhost:5000` 접속

## 📊 시스템 구성

### CT/PT 설정
- **CT 비율**: 6 (전류 변성기)
- **PT 비율**: 120 (전압 변성기)  
- **WP 계수**: 0.2
- **펄스당 전력량**: 144 Wh = 0.144 kWh

### 계산 공식
```
RTU: Total_p = pulse_count × CTR × PTR × WPP × 0.001
펄스 1개당 전력량 = 6 × 120 × 0.2 × 0.001 = 0.144 kWh = 144 Wh
```

## 🎛️ 웹 인터페이스 기능

### 인버터 제어
- 전원 ON/OFF
- P제어 ↔ MPPT제어 모드 전환
- 정격전력, 설정전력, 발전제한율 조정
- 실시간 출력 상태 모니터링

### 계량기 제어
- 수동 WP 펄스 생성
- 수동 EOI 신호 생성
- 연속 WP 펄스 생성 (10회, 50회, 100회)
- 빠른 펄스 테스트 (최소간격)
- 다양한 간격 펄스 테스트
- 발전량 및 펄스 카운터 초기화

### 실시간 모니터링
- 인버터 출력 상태 (전력, 전압, 전류, 무효전력)
- 환경 조건 (일사량, 온도, 위상각)
- 계량기 측정값 (1차측, 2차측, 측정값)
- 발전량 누적 및 펄스 카운트
- 실시간 로그

## 🔧 API 엔드포인트

### 상태 조회
- `GET /api/status`: 전체 시스템 상태 조회

### 인버터 제어
- `POST /api/inverter_control`: 인버터 제어
  - `toggle_power`: 전원 ON/OFF
  - `set_p_control`: P제어 모드
  - `set_mppt_control`: MPPT제어 모드
  - `set_nominal_power`: 정격전력 설정
  - `set_power`: 설정전력 설정
  - `set_limit`: 발전제한율 설정

### 계량기 제어
- `POST /api/meter_control`: 계량기 제어
  - `manual_wp`: 수동 WP 펄스
  - `manual_eoi`: 수동 EOI 신호
  - `bulk_wp`: 연속 WP 펄스
  - `test_wp_fast`: 빠른 펄스 테스트
  - `test_wp_intervals`: 간격 테스트

### 초기화
- `POST /api/reset`: 카운터 초기화

## 📝 로그 및 디버깅

프로그램 실행 시 콘솔에서 다음 정보를 확인할 수 있습니다:
- 시스템 시작 메시지
- WP 펄스 생성 로그
- EOI 신호 생성 로그
- 10초마다 상태 요약
- 웹 요청 처리 로그

## 🔄 Arduino 버전과의 차이점

### PC 환경 최적화
- WiFi 연결 불필요 (localhost 실행)
- GPIO 핀 출력 시뮬레이션 (로그로 출력)
- 시리얼 통신 기능 제외 (웹 인터페이스로 대체)

### 동일한 기능
- 인버터 시뮬레이션 로직
- 계량기 계산 공식
- RTU 펄스 생성 타이밍
- 웹 인터페이스 UI/UX

## 🛠️ 개발 환경

- **Python**: 3.7+
- **Flask**: 2.3.3
- **Werkzeug**: 2.3.7
- **운영체제**: Windows, macOS, Linux

## 📄 라이선스

이 프로젝트는 원본 ESP32 Arduino 코드를 Python으로 포팅한 버전입니다.

## 🤝 기여

버그 리포트나 기능 개선 제안은 GitHub Issues를 통해 제출해 주세요.

---

**ESP32 통합 시뮬레이터 v1.0 (Python 버전)**  
인버터 시뮬레이터 + 모의계량기 + RTU 제어 통합
